variables:
  UV_CACHE_DIR: .uv-cache

  # GitLab CI creates a separate mountpoint for the build directory,
  # so we need to copy instead of using hard links.
  UV_LINK_MODE: copy

cache:
  - key:
      files:
        - uv.lock
    paths:
      - $UV_CACHE_DIR

default:
  image: ghcr.io/astral-sh/uv:python3.9-bookworm-slim@sha256:25db5e94e55b3b089ea4eb1dc5b4ae9270f5b2e8ac79aebf489559a0199c91fe
  tags:
    - pangea-internal
  after_script:
    - uv cache prune --ci

stages:
  - lint
  - build
  - unit_tests
  - integration_tests
  - examples
  - publish

include:
  - /examples/.examples-ci.yml
  - /packages/pangea-django/.django-ci.yml
  - /packages/pangea-sdk/.sdk-ci.yml
